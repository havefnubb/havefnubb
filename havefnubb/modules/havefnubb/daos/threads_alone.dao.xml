<?xml version="1.0" encoding="UTF-8"?>
<dao xmlns="http://jelix.org/ns/dao/1.0">
    <datasources>
        <primarytable name="threads" realname="threads"  primarykey="id_thread" />
    </datasources>
    <record>
        <property name="id_thread"     fieldname="id_thread" datatype="autoincrement"/>
        <property name="id_user_thread" fieldname="id_user" datatype="int" required="true"/>
        <property name="id_forum_thread" fieldname="id_forum" datatype="int" required="true"/>
        <property name="status_thread" fieldname="status"  datatype="int" required="true"/>
        <property name="nb_viewed"     fieldname="nb_viewed"  datatype="int" required="true"/>
        <property name="nb_replies"    fieldname="nb_replies"  datatype="int" required="true"/>
        <property name="id_first_msg"  fieldname="id_first_msg"  datatype="int" required="true"/>
        <property name="id_last_msg"   fieldname="id_last_msg"  datatype="int" required="true"/>
        <property name="date_created"  fieldname="date_created" datatype="int" required="true"/>
        <property name="date_last_post" fieldname="date_last_post" datatype="int" />
    </record>

        <!--
        status :
                1 - pined
                2 - pinedclosed
                3 - opened
                4 - closed
                5 - censored
                6 - uncensored
                7 - hidden
        -->
    <factory>
       <!-- for stats purpose -->
        <method name="countAllThreads" type="count">
        </method>
        <method name="countThreadsByIdForum" type="count">
            <parameter name="id_forum" />
            <conditions>
                <eq property="id_forum_thread" expr="$id_forum" />
            </conditions>
        </method>
        <method name="countUnreadThread" type="count">
            <parameter name="start"/>
            <parameter name="end"/>
            <conditions logic="AND">
                <gteq property="date_last_post" expr="$start" />
                <lteq property="date_last_post" expr="$end" />
            </conditions>
            <order>
                <orderitem property="date_last_post" way="desc" />
            </order>
        </method>
        <method name="countUnreadThreadVisible" type="count">
            <parameter name="start"/>
            <parameter name="end"/>
            <conditions logic="AND">
                <gteq property="date_last_post" expr="$start" />
                <lteq property="date_last_post" expr="$end" />
                <neq property="status_thread" value="7"/>
            </conditions>
            <order>
                <orderitem property="date_last_post" way="desc" />
            </order>
        </method>
    </factory>
</dao>
