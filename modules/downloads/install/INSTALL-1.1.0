Downloads : Gestionnaire de Téléchargements
Version : 1.1.0 
Auteur : FoxMaSk
Date : 14/12/2008
Description : Ce module vous permet d'ajouter des fichiers à télécharger sur votre site
Vous pouvez autoriser des visiteurs à les télécharger ou bien uniquement les membres de votre site
Vou pouvez également permettre (ou non) de télécharger vos fichiers depuis un autre site

PréRequis : 
- Jelix 1.1RC1
- jAcl2 module installé

Recommandé (si utilisé en tant qu'APPLICATION mais non obligatoire si utilisé en tant que MODULE) :
- jCommunity 0.1 ou plus

Installation : 

0) Structure du module :

répertoire downloads :

->classes 
---->download_config.class.php : classe lisant le fichier de configuration du module
---->download_files.class.php : classe gerant l'accès aux fichiers
---->listdir.class.php : classe listant les répertoires autorisés à un utilisateur
---->readmodule.class.php : classe lisant le fichier module.xml

->controllers
---->default.classic.php : contrôleur pour l'accès publique 
---->feeds.classic.php : contrôleur générant les flux RSS
---->mgr.classic.php : contrôleur de l'accès admin, gestion du module.

->daos
----->downloads.dao.xml : DAO de la table Downloads
----->downloads_cat.dao.xml : DAO de la table Downloads Cat

->forms
----->config.form.xml : formulaire de configuration du module downloads
----->edit.form.xml : formulaire d'edition/ajout de downloads

->install
----->files : dossier contenant les fichiers téléchargeables
----->themes : dossier contenant images et css du module
----->INSTALL-1.1.0 : ce fichier ;)
----->downloads.module.ini.php.dist : fichier de configuration (d'exemple) du module
----->urls.xml : fichier contenant les urls à utiliser quand vous utilisez le moteur d'url significant

->locales
----->en_EN : traductions anglaise du module
----->fr_FR : "V.O" du module ;)

->templates
----->en_EN : template en version anglaise 
----->fr_FR : template en "V.O" du module ;)

->zones
----->admin.zone.php : zone affichant le contenu du fichier module.xml 
----->admin_list.zone.php : zone affichant la liste des fichiers téléchargeables
----->admincat.zone.php : zone affichant la liste catégories de téléchargements
----->adminconfig.zone.php : zone affichant le formulaire de configuration du module
----->adminmenu.zone.php : zone affichant tous les liens de l'administration du module
----->block.zone.php : zone affichant les derniers téléchargements ajoutés
----->list.zone.php : zone affichant la liste des téléchargements 
----->view.zone.php : zone affichant UN téléchargement

->module.xml : fichier de définition du module au format jelix


Modes d'installation : 
- soit vous souhaitez utiliser l'APPLICATION downloads seule : 
  alors et N'effectuer PAS l'étape 1.2 et l'étape 2 tout entière
- soit vous souhaitez utiliser le MODULE downloads au sein d'une application existante :
  alors effectuer toutes les etapes


1) Fichiers :
1.1) Décompresser l'archive dans le dossier modules
1.2) Copier les dossiers "install/themes" et "install/files" dans votre dossier www
    
2) Paramètrage :    
2.1) fichier defaultconfig.ini.php
Assurez vous que le module downloads soit bien dans le modulePath 
(cf paramètre modulesPath dans var/config/defaultconfig.ini.php) 

2.2) fichier downloads.module.ini.php
copier le fichier downloads.module.ini.php.dist dans le même répertoire que defaultconfig.ini.php sous le nom 
downloads.module.ini.php

3) Base de données :
executer le script downloads.create-table.sql

4) jAcl2 :
Installer jAcl2 comme suit http://jelix.org/articles/fr/manuel-1.1/droits2/utilisation

4.1) Ajouter les sujets suivants à votre installation via l'invite de commandes :

php jelix.php acl2right subject_create "downloads.manage" "downloads~acl2.downloads.manage"
php jelix.php acl2right subject_create "downloads.config" "downloads~acl2.downloads.config"
php jelix.php acl2right subject_create "downloads.delete" "downloads~acl2.downloads.delete"
php jelix.php acl2right subject_create "downloads.index" "downloads~acl2.downloads.index"
php jelix.php acl2right subject_create "downloads.list" "downloads~acl2.downloads.list"

4.2) Groupe Managers
création du groupe "Managers" comme suit :
php jelix.php acl2group  create "Managers"

4.3) lié les sujets au groupe "Managers"
rattacher les sujets au groupe Managers (en supposant que Managers soit le groupe 4 apres vérification avec la commande php jelix.php acl2group list)

php jelix.php acl2right add 4 "downloads.manage"
php jelix.php acl2right add 4 "downloads.config"
php jelix.php acl2right add 4 "downloads.delete"
php jelix.php acl2right add 4 "downloads.index"
php jelix.php acl2right add 4 "downloads.list"

5) Utilisation :
Accédez au module comme suit (avec le moteur d'url simple)
http://localhost/index.php?module=downloads&dir=files

Accédez au module comme suit (avec le moteur d'url significant)
http://localhost/downloads/files

6) Fils RSS
dans le fichier downloads.module.ini.php.dist, modifiez manuellement les paramètres suivants
avec les valeurs qui vous concernent :

website.url=http://localhost.downloads/
website.copyright=FoxMaSk 2008
website.description=FoxMaSk 0wnZ
website.author=FoxMaSk
website.ttl=60

7) Conclusion
Ce que fourni le module downloads : 

une partie administration accessible via http://votresite/index.php?module=downloads&action=mgr:index
une partie publique accessible via http://votresite/index.php?module=downloads&dir=XXX
où XXX est le nom du repertoire de stockage de vos fichiers
un "block" des derniers téléchargements pour afficher dans un menu de la partie publique. 
Utiliser {zone 'downloads~block','XXX')} dans votre template pour ce faire.
où XXX est le nom du repertoire de stockage de vos fichiers

Regarder, à titre d'exemple, le template main.tpl contenant le template complet de "l'application" downloads


